<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenMarket Library - Asosiy Misol</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .product {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            display: inline-block;
            width: 200px;
        }

        .product img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 4px;
        }

        .product img.lazy {
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .product img.loaded {
            opacity: 1;
        }

        button {
            background: #16a34a;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #15803d;
        }

        #search {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        #cart-info {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border: 2px solid #16a34a;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <h1>ðŸŒ¿ GreenMarket Library - Asosiy Misol</h1>

    <div id="cart-info">
        <h3>ðŸ›’ Savat</h3>
        <p>Mahsulotlar: <span id="cart-count">0</span></p>
    </div>

    <input type="text" id="search" placeholder="Mahsulotlarni qidiring...">

    <div id="products"></div>

    <script type="module">
        // GreenMarket kutubxonasini import qilish
        import GreenMarket from '../src/GreenMarketLib.js';

        // Initsializatsiya
        const shop = new GreenMarket({
            language: 'uz',
            enableCache: true,
            enableLazyLoad: true
        });

        // Mahsulotlarni render qilish
        function renderProducts(products) {
            const container = document.getElementById('products');
            container.innerHTML = products.map(p => `
                <div class="product" data-product-id="${p.id}">
                    <img data-src="${p.image || 'https://via.placeholder.com/200'}" 
                         alt="${p.name}" 
                         class="lazy">
                    <h3>${p.name}</h3>
                    <p>${p.price.toLocaleString()} so'm</p>
                    <p style="font-size: 12px; color: #666;">${p.description}</p>
                    <button class="add-to-cart-btn">Savatga qo'shish</button>
                </div>
            `).join('');

            // Lazy loading ni ishga tushirish
            shop.lazyLoader.observeImages();
        }

        // Savat ma'lumotlarini yangilash
        function updateCartInfo() {
            const count = shop.cart.getItemCount();
            document.getElementById('cart-count').textContent = count;
        }

        // Qidiruv (debounce bilan)
        const searchInput = document.getElementById('search');
        searchInput.addEventListener('input', (e) => {
            shop.searchProducts(e.target.value, (results) => {
                renderProducts(results);
            });
        });

        // Savatga qo'shish (event delegation bilan)
        shop.on(document.body, 'click', '.add-to-cart-btn', async function () {
            const productId = this.closest('.product').dataset.productId;
            const success = await shop.addToCart(productId, 1);
            if (success) {
                updateCartInfo();
            }
        });

        // Dastlabki render
        const allProducts = shop.products.getAllProducts();
        renderProducts(allProducts);
        updateCartInfo();

        // Statistika
        console.log('ðŸ“Š Statistika:', shop.getStats());
    </script>
</body>

</html>